{% load xadmin_tags %}{% load i18n %}<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0">
  {% block extrameta %}
  <meta name="description" content="">
  <meta name="author" content="">
  {% endblock %}
  {% block blockbots %}<meta name="robots" content="NONE,NOARCHIVE" />{% endblock %}
  <title>{% block title %}{% endblock %}</title>
  {% vendor 'bootstrap.css' %}
  <link rel="stylesheet" type="text/css" href="{% static "xadmin/css/themes/bootstrap-xadmin.css" %}" />
  {% vendor 'font-awesome.css' 'xadmin.main.css' 'xadmin.plugins.css' 'xadmin.responsive.css' %}
  {{ media.css }}
  {% block extrastyle %}{% endblock %}
  <script src="/static/xadmin/js/jquery-1.7.1.min.js" type="text/javascript"></script>
  {% url 'xadmin:index' as indexurl %}
  <script type="text/javascript">
    window.__admin_media_prefix__ = "{% filter escapejs %}{% static "xadmin/" %}{% endfilter %}";
    window.__admin_path_prefix__ = "{% filter escapejs %}{{ indexurl }}{% endfilter %}";
  </script>
  <script type="text/javascript" src="{% url 'xadmin:jsi18n' %}"></script>
  {% block extrahead %}{% endblock %}
  {% view_block 'extrahead' %}
  
  {% block function %}
  <link media="screen" rel="stylesheet" href="/static/xadmin/css/demo.css"/>

  <script type="text/javascript">
  jQuery(document).ready(function(){
      var qcloud={};
      $('[_t_nav]').hover(function(){
          var _nav = $(this).attr('_t_nav');
          clearTimeout( qcloud[ _nav + '_timer' ] );
          qcloud[ _nav + '_timer' ] = setTimeout(function(){
          $('[_t_nav]').each(function(){
          $(this)[ _nav == $(this).attr('_t_nav') ? 'addClass':'removeClass' ]('nav-up-selected');
          });
          $('#'+_nav).stop(true,true).slideDown(200);
          }, 150);
      },function(){
          var _nav = $(this).attr('_t_nav');
          clearTimeout( qcloud[ _nav + '_timer' ] );
          qcloud[ _nav + '_timer' ] = setTimeout(function(){
          $('[_t_nav]').removeClass('nav-up-selected');
          $('#'+_nav).stop(true,true).slideUp(200);
          }, 150);
      });
  });
  </script>
  {% endblock %}

<link title="" href="/static/report/css/style.css" rel="stylesheet" type="text/css"  />
<script type="text/javascript" src="/static/xadmin/js/CJL.0.1.min.js"></script>

<script type="text/javascript" src="/static/xadmin/js/jq.resizableColumns.js"></script>
<script> 
$(document).ready(function() {
    if ($("#idTableFixed").length>0){
        var tf = new TableFixed("idTableFixed", '');
    }
});

var TableFixed = function(table, t_url, options){
    this._oTable = $$(table);//原table
    this._nTable = this._oTable.cloneNode(false);//新table
    this._nTable.id = "";//避免id冲突

    this._oTablePos = {};//记录原table坐标参数
    this._oRowPos = {};//记录原tr坐标参数
    this._viewHeight = this._oTableHeight = this._nTableHeight = 0;//记录高度
    this._nTableViewTop = 0;//记录新table视框top
    this._selects = [];//select集合，用于ie6覆盖select

    this._setOptions(options);

    this._index = this.options.index;
    this._pos = this.options.pos;
    this.t_url = t_url

    this.auto = !!this.options.auto;
    this.hide = !!this.options.hide;

    $$E.addEvent(window, "resize", $$F.bind( this.setPos, this ));
    $$E.addEvent(window, "scroll", $$F.bind( this.run, this ));

    this._oTable.parentNode.insertBefore(this._nTable, this._oTable);
    this.clone(this.t_url);

};




TableFixed.prototype = {
  //chrome/safari透明用rgba(0, 0, 0, 0)
  _transparent: $$B.chrome || $$B.safari ? "rgba(0, 0, 0, 0)" : "transparent",
  //设置默认属性
  _setOptions: function(options) {
    this.options = {//默认值
        index:  0,//tr索引
        auto:   false,//是否自动定位
        pos:    0.06,//自定义定位位置百分比(0到1)
        hide:   false//是否隐藏（不显示）
    };
    $$.extend(this.options, options || {});
  },
  //克隆表格
  clone: function(t_url,index) {
    //设置table样式
    $$D.setStyle(this._nTable, {
        width: this._oTable.offsetWidth + "px",
        position: $$B.ie6 ? "absolute" : "fixed",
        zIndex: 99, borderTopWidth: 0, borderBottomWidth: 0
    });
    //设置index
    this._index = Math.max(0, Math.min(this._oTable.rows.length - 1, isNaN(index) ? this._index : index));
    //克隆新行
    this._oRow = this._oTable.rows[this._index];
    var oT = this._oRow, nT = oT.cloneNode(true);
    if( oT.parentNode != this._oTable ){
        nT = oT.parentNode.cloneNode(false).appendChild(nT).parentNode;
    }
    //插入新行
    if ( this._nTable.firstChild ) {
        this._nTable.replaceChild( nT, this._nTable.firstChild );
    } else {
        this._nTable.appendChild(nT);
    }
    //去掉table上面和下面的边框
    if ( this._oTable.border > 0 ) {
        switch (this._oTable.frame) {
            case "above" :
            case "below" :
            case "hsides" :
                this._nTable.frame = "void"; break;
            case "" :
            case "border" :
            case "box" :
                this._nTable.frame = "vsides"; break;
        }
    }
     //设置td样式
     var nTds = this._nTable.rows[0].cells, getStyle = $$D.getStyle;

     var b_page_url = window.location.href
     var b_all_url = (b_page_url.split('?').pop()).split('&');
     var b_url_params = '';
     var b_width_list = '';
	 if(t_url != ''){
	 	b_width_list = t_url
	 }else{
	     for (var all=0;all<b_all_url.length;all++){
	        if (b_all_url[all].indexOf('_colwidths=') != -1){
	            b_url_params = b_all_url[all].split('=').pop();
	            b_width_list = b_url_params.split(',')
	        }
	    }
	}


    $$A.forEach(this._oRow.cells, $$F.bind(function(o, i){
        var style = nTds[i].style;
        //设置td背景
        style.backgroundColor = this._getBgColor(o);
        //设置td的width,没考虑ie8/chrome设scroll的情况
		if(b_width_list.length == 0){
			style.width = (document.defaultView ? parseFloat(getStyle(o, "width")): ( o.clientWidth - parseInt(getStyle(o, "paddingLeft")) - parseInt(getStyle(o, "paddingRight")) )) + "px";
		}else{
			style.width = (document.defaultView ? b_width_list[i]: ( o.clientWidth - parseInt(getStyle(o, "paddingLeft")) - parseInt(getStyle(o, "paddingRight")) )) + "px";
		}
    }, this));
    //获取table高度
    this._oTableHeight = this._oTable.offsetHeight;
    this._nTableHeight = this._nTable.offsetHeight;
    //设置坐标属性
    this._oTablePos = $$D.rect(this._oTable);//获取原table位置
    this._oRowPos = $$D.rect(this._oRow);//获取原tr位置

    this.setPos();
  },
  //获取背景色
  _getBgColor: function(node) {
    var bgc = "";
    //不要透明背景（没考虑图片背景）
    while (bgc === this._transparent && (node = node.parentNode) != document) {
        bgc = $$D.getStyle(node, "backgroundColor");
    }
    return bgc === this._transparent ? "#fff" : bgc;
  },
  //设置新table位置属性
  setPos: function(pos) {
    //设置pos
    this._pos = Math.max(0, Math.min(1, isNaN(pos) ? this._pos : pos));
    //获取位置
    this._viewHeight = document.documentElement.clientHeight;
    this._nTableViewTop = (this._viewHeight - this._nTableHeight) * this._pos;
    this.run();
  },
  //运行
  run: function() {
    var tStyle = this._nTable.style;
    if(!this.hide){
        var top = $$D.getScrollTop(), left = $$D.getScrollLeft()
            //原tr是否超过顶部和底部
            ,outViewTop = this._oRowPos.top < top, outViewBottom = this._oRowPos.bottom > top + this._viewHeight;
        //原tr超过视窗范围
        if ( outViewTop || outViewBottom ) {
            var viewTop = !this.auto ? this._nTableViewTop
                    : (outViewTop ? 0 : (this._viewHeight - this._nTableHeight))//视窗top
                ,posTop = viewTop + top;//位置top
            //在原table范围内
            if( posTop > this._oTablePos.top && posTop + this._nTableHeight < this._oTablePos.bottom ){
                //定位
                if( $$B.ie6 ){
                    tStyle.top = posTop + "px";
                    tStyle.left = this._oTablePos.left + "px";
                    setTimeout($$F.bind(this._setSelect, this), 0);//iebug
                }else{
                    tStyle.top = viewTop + "px";
                    tStyle.left = this._oTablePos.left - left + "px";
                }
                return;
            }
        }
    }
    //隐藏
    tStyle.top = "-99999px";
    $$B.ie6 && this._resetSelect();
  }
};
</script>

<script src="/static/xadmin/layer/layer.js"></script>
</head>
<body id = "mainbody" class="{% block bodyclass %}{% endblock %}">
  {% block body %}
    <div id="content-block" class="col-sm-12">
    {% block content %}{% endblock content %}
    </div>
  {% endblock body %}
  {% vendor 'jquery-ui-sortable.js' 'bootstrap.js' 'xadmin.main.js' 'xadmin.responsive.js' %}
  {{ media.js }}
  {% block extrabody %}{% endblock %}
  {% view_block 'extrabody' %}
  

<div id="mask" style="position:fixed;top:0;left:0;right:0;bottom:0;background-color:#000;opacity:0.7;z-index:296;display:none;">
</div> 

<script type="text/javascript">  
    //checkbox 全选/取消全选  
    var isCheckAll = false;  
    function swapCheck() {
        if (isCheckAll) {  
            $("input[type='checkbox']").each(function() {
                if (this.name == '_selected_action'){
                    this.checked = false;
                }
            });
            isCheckAll = false;  
        } else {  
            $("input[type='checkbox']").each(function() {
                if (this.name == '_selected_action'){
                    this.checked = true;
                }
            });
            isCheckAll = true;  
        }  
    }
</script>

<script type="text/javascript">
if($("#add").length>0) {
  $("#add").on('click',function () {
      document.getElementById("mask").style.display = "block";
  })
}
</script> 

<script type="text/javascript">
if($("#save").length>0) {
  $("#save").on('click',function () {
      document.getElementById("mask").style.display = "block";
  })
}
if($("#save_and_another").length>0) {
  $("#save_and_another").on('click',function () {
      document.getElementById("mask").style.display = "block";
  })
}
if($("#save_and_editing").length>0) {
  $("#save_and_editing").on('click',function () {
      document.getElementById("mask").style.display = "block";
  })
}
if($("#delete").length>0) {
  $("#delete").on('click',function () {
      document.getElementById("mask").style.display = "block";
  })
}
</script> 

</div>
</body>
</html>
